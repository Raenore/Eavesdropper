-- Copyright The Eavesdropper Authors
-- Inspired by Sippy Cup
-- SPDX-License-Identifier: Apache-2.0

local L = ED.Localization;

if not C_AddOns.IsAddOnLoaded("totalRP3") then
	return;
end

local function onStart()
	TRP3_API.RegisterCallback(TRP3_Addon, TRP3_Addon.Events.WORKFLOW_ON_LOADED, function()
		if not TRP3_API.toolbar then
			return;
		end

		TRP3_API.toolbar.toolbarAddButton{
			id = "trp3_eavesdropper",
			icon = ED.Globals.addon_wow_icon_texture,
			configText = ED.Globals.addon_title,
			tooltip = ED.Globals.addon_title,
			tooltipSub = L.ADDON_TOOLTIP_HELP,
			onClick = function(_, _, button)
				if button == "LeftButton" then
					ED.Settings:ShowSettings();
				elseif button == "RightButton" then
					ED.Settings:ShowSettings(4);
				end
			end,
		};
	end);
end

-- Module Registration
TRP3_API.module.registerModule({
	["name"] = "Eavesdropper",
	["description"] = "Adds a toolbar button to open Eavesdropper easily.",
	["version"] = ED.Globals.addon_version,
	["id"] = "trp_eavesdropper",
	["onStart"] = onStart,
	["minVersion"] = 3,
})
